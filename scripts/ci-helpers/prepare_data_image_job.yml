.docker_image_builder_job:
  variables:
    DOCKER_BUILDKIT: 1
    DOCKER_DRIVER: overlay2
    DOCKER_TLS_CERTDIR: "/certs"
  image: docker:20.10.10
  services:
    - docker:20.10.10-dind

  before_script:
    - apk update && apk add bash git ca-certificates curl

.prepare_haf_data_5m_image:
  extends: .docker_image_builder_job

  variables:
    HAF_SUBMODULE_DIR: "$CI_PROJECT_DIR/haf"
    SCRIPTS_PATH: "$HAF_SUBMODULE_DIR/scripts"
  script:
    - $SCRIPTS_PATH/ci-helpers/get_image4submodule.sh "$HAF_SUBMODULE_DIR"
    - HAF_IMAGE_NAME=$(cat haf_docked_image.txt)
    - "echo HAF_IMAGE_NAME=$HAF_IMAGE_NAME > haf_docker_image_name.env"

  artifacts:
    reports:
      dotenv: haf_docker_image_name.env
    expire_in: 6 hours
