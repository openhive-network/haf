
# Overview of state provider application performance
```keyauth_app.sql``` is a sample application employing state providers inspired by the balance tracker.

## To run:

- add code to database
```
psql -a -v "ON_ERROR_STOP=1" -d haf_block_log -f src/hive_fork_manager/state_providers/performance_examination/keyauth_app.sql
```
- call the application for a given block count (e.g. 70000000 ) and a step (e.g. 1000000 or 10000000)
```
psql -a -v "ON_ERROR_STOP=1" -d haf_block_log -c '\timing'  -c "call keyauth_app.main('keyauth_app', blocks_count, step)"
```
- to break execution execute the following in another terminal
```
psql -d haf_block_log -c 'SELECT keyauth_app.stopprocessing();'
```
- to clear data
```
psql -a -v "ON_ERROR_STOP=1" -d haf_block_log -c "select hive.app_reset_data('keyauth_app');"
```
- sometimes the above clearing is not enough, then run
```
drop schema keyauth_app cascade;
drop table hive.dummy_table_to_make_it_forking_application cascade;
drop table hive.shadow_hive_keyauth_app_keyauth cascade;
drop table hive.shadow_keyauth_app_dummy_table_to_make_it_forking_application cascade;
drop table hive.shadow_hive_keyauth_app_accounts cascade;
drop table hive.keyauth_app cascade;
drop table hive.keyauth_app_keyauth cascade;
delete from hive.triggers where owner = 'syncad';
delete from hive.state_providers_registered where state_provider  = 'KEYAUTH';
delete from hive.registered_tables where owner  = 'syncad';
delete from hive.contexts where owner  = 'syncad';


drop table keyauth_app.LOG_TABLE;
select hive.app_reset_data('keyauth_app')
```

## Timing data
is available in the keyauth_app.LOG_TABLE table before clearing.

## Sample results

show that in case of a massive event till block 69396825 took 8 hours 15 minutes and then in life sync 0.001 - 0.002 seconds per block.


```
--
-- PostgreSQL database dump
--

-- Dumped from database version 14.5 (Ubuntu 14.5-0ubuntu0.22.04.1)
-- Dumped by pg_dump version 14.5 (Ubuntu 14.5-0ubuntu0.22.04.1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: log_table; Type: TABLE; Schema: public; Owner: syncad
--

CREATE TABLE public.log_table (
    first_block integer,
    last_block integer,
    "time" interval
);


ALTER TABLE public.log_table OWNER TO syncad;

--
-- Data for Name: log_table; Type: TABLE DATA; Schema: public; Owner: syncad
--

COPY public.log_table (first_block, last_block, "time") FROM stdin;
1	69396825	08:15:18.212118
69396826	69396826	00:00:00.002909
69396827	69396827	00:00:00.001358
69396828	69396828	00:00:00.00148
69396829	69396830	00:00:00.009096
69396831	69396831	00:00:00.001689
69396832	69396832	00:00:00.001622
69396833	69396833	00:00:00.001381
69396834	69396834	00:00:00.001442
69396835	69396835	00:00:00.001224
69396836	69396836	00:00:00.001163
69396837	69396837	00:00:00.0014
69396838	69396838	00:00:00.001691
69396839	69396839	00:00:00.001425
69396840	69396840	00:00:00.001186
69396841	69396841	00:00:00.001503
69396842	69396842	00:00:00.001201
69396843	69396843	00:00:00.001232
69396844	69396844	00:00:00.001881
69396845	69396845	00:00:00.001536
69396846	69396846	00:00:00.001515
69396847	69396847	00:00:00.001174
69396848	69396848	00:00:00.001613
69396849	69396849	00:00:00.001865
69396850	69396850	00:00:00.001011
69396851	69396851	00:00:00.00132
69396852	69396852	00:00:00.001511
69396853	69396853	00:00:00.001784
69396854	69396854	00:00:00.001503
69396855	69396855	00:00:00.001285
69396856	69396856	00:00:00.00132
69396857	69396857	00:00:00.001243
69396858	69396858	00:00:00.001227
69396859	69396859	00:00:00.001517
69396860	69396860	00:00:00.001224
69396861	69396861	00:00:00.001469
69396862	69396862	00:00:00.001377
69396863	69396863	00:00:00.001651
69396864	69396864	00:00:00.001386
69396865	69396865	00:00:00.002102
69396866	69396866	00:00:00.00154
69396867	69396867	00:00:00.001531
69396868	69396868	00:00:00.001711
69396869	69396869	00:00:00.001492
69396870	69396870	00:00:00.001598
69396871	69396871	00:00:00.001529
69396872	69396872	00:00:00.001478
69396873	69396873	00:00:00.001713
69396874	69396874	00:00:00.001385
69396875	69396875	00:00:00.001348
69396876	69396876	00:00:00.001595
69396877	69396877	00:00:00.001577
69396878	69396878	00:00:00.001657
69396879	69396879	00:00:00.00135
69396880	69396880	00:00:00.001684
69396881	69396881	00:00:00.001415
69396882	69396882	00:00:00.001357
69396883	69396883	00:00:00.001675
69396884	69396884	00:00:00.001545
69396885	69396885	00:00:00.002239
69396886	69396886	00:00:00.001552
69396887	69396887	00:00:00.001851
69396888	69396888	00:00:00.001861
69396889	69396889	00:00:00.001548
69396890	69396890	00:00:00.001653
69396891	69396891	00:00:00.001668
69396892	69396892	00:00:00.001456
69396893	69396893	00:00:00.001564
69396894	69396894	00:00:00.001483
69396895	69396895	00:00:00.00157
69396896	69396896	00:00:00.001506
69396897	69396897	00:00:00.001516
69396898	69396898	00:00:00.001618
69396899	69396899	00:00:00.001493
69396900	69396900	00:00:00.001789
69396901	69396901	00:00:00.00162
69396902	69396902	00:00:00.001335
69396903	69396903	00:00:00.001827
69396904	69396904	00:00:00.001517
69396905	69396905	00:00:00.001749
69396906	69396906	00:00:00.001683
69396907	69396907	00:00:00.001378
69396908	69396908	00:00:00.001664
69396909	69396909	00:00:00.001465
69396910	69396910	00:00:00.001595
69396911	69396911	00:00:00.00149
69396912	69396912	00:00:00.001449
69396913	69396913	00:00:00.001623
69396914	69396914	00:00:00.001112
69396915	69396915	00:00:00.00146
69396916	69396916	00:00:00.001427
69396917	69396917	00:00:00.001298
69396918	69396918	00:00:00.001535
69396919	69396919	00:00:00.001309
69396920	69396920	00:00:00.001519
69396921	69396921	00:00:00.001574
69396922	69396922	00:00:00.001576
69396923	69396923	00:00:00.001561
69396924	69396924	00:00:00.001706
69396925	69396925	00:00:00.001652
69396926	69396926	00:00:00.001493
69396927	69396927	00:00:00.001514
69396928	69396928	00:00:00.001808
69396929	69396929	00:00:00.00145
69396930	69396930	00:00:00.001769
69396931	69396931	00:00:00.001484
69396932	69396932	00:00:00.001632
69396933	69396933	00:00:00.001755
69396934	69396934	00:00:00.001334
69396935	69396935	00:00:00.001959
69396936	69396936	00:00:00.001292
69396937	69396937	00:00:00.001539
69396938	69396938	00:00:00.001489
69396939	69396939	00:00:00.001571
69396940	69396940	00:00:00.00125
69396941	69396941	00:00:00.001264
69396942	69396942	00:00:00.001314
69396943	69396943	00:00:00.00146
69396944	69396944	00:00:00.001792
69396945	69396945	00:00:00.001847
69396946	69396946	00:00:00.001472
69396947	69396947	00:00:00.001477
69396948	69396948	00:00:00.001419
69396949	69396949	00:00:00.001602
69396950	69396950	00:00:00.001466
69396951	69396951	00:00:00.001353
69396952	69396952	00:00:00.001468
69396953	69396953	00:00:00.001512
69396954	69396954	00:00:00.001361
69396955	69396955	00:00:00.001232
69396956	69396956	00:00:00.00199
69396957	69396957	00:00:00.001367
69396958	69396958	00:00:00.001359
69396959	69396959	00:00:00.002042
69396960	69396960	00:00:00.001084
69396961	69396961	00:00:00.001462
69396962	69396962	00:00:00.001171
69396963	69396963	00:00:00.001902
69396964	69396964	00:00:00.001394
69396965	69396965	00:00:00.001551
69396966	69396966	00:00:00.001434
69396967	69396967	00:00:00.001272
69396968	69396968	00:00:00.00135
69396969	69396969	00:00:00.001273
69396970	69396970	00:00:00.001386
69396971	69396971	00:00:00.001642
69396972	69396972	00:00:00.001679
69396973	69396973	00:00:00.001431
69396974	69396974	00:00:00.001542
69396975	69396975	00:00:00.001388
69396976	69396976	00:00:00.001528
69396977	69396977	00:00:00.001733
69396978	69396978	00:00:00.001909
69396979	69396979	00:00:00.001661
69396980	69396980	00:00:00.001731
69396981	69396981	00:00:00.001473
69396982	69396982	00:00:00.001583
69396983	69396983	00:00:00.001595
69396984	69396984	00:00:00.001701
69396985	69396985	00:00:00.001834
69396986	69396986	00:00:00.001664
69396987	69396987	00:00:00.001673
69396988	69396988	00:00:00.001438
69396989	69396989	00:00:00.00141
69396990	69396990	00:00:00.00168
69396991	69396991	00:00:00.001741
69396992	69396992	00:00:00.001527
69396993	69396993	00:00:00.001619
69396994	69396994	00:00:00.001388
69396995	69396995	00:00:00.001809
69396996	69396996	00:00:00.001419
69396997	69396997	00:00:00.001637
69396998	69396998	00:00:00.001564
69396999	69396999	00:00:00.001406
69397000	69397000	00:00:00.001392
69397001	69397001	00:00:00.001133
69397002	69397002	00:00:00.0014
69397003	69397003	00:00:00.00116
69397004	69397004	00:00:00.001459
69397005	69397005	00:00:00.00183
69397006	69397006	00:00:00.001374
69397007	69397007	00:00:00.00164
69397008	69397008	00:00:00.001196
69397009	69397009	00:00:00.001277
69397010	69397010	00:00:00.001329
69397011	69397011	00:00:00.00109
69397012	69397012	00:00:00.00136
69397013	69397013	00:00:00.001554
69397014	69397014	00:00:00.004544
69397015	69397015	00:00:00.00139
69397016	69397016	00:00:00.001204
69397017	69397017	00:00:00.001732
69397018	69397018	00:00:00.001914
69397019	69397019	00:00:00.00126
69397020	69397020	00:00:00.001478
69397021	69397021	00:00:00.00132
69397022	69397022	00:00:00.00172
69397023	69397023	00:00:00.001617
69397024	69397024	00:00:00.001369
69397025	69397025	00:00:00.001586
69397026	69397026	00:00:00.001282
69397027	69397027	00:00:00.001469
69397028	69397028	00:00:00.001223
69397029	69397029	00:00:00.001422
69397030	69397030	00:00:00.001501
69397031	69397031	00:00:00.001182
69397032	69397032	00:00:00.001581
69397033	69397033	00:00:00.001331
69397034	69397034	00:00:00.001173
69397035	69397035	00:00:00.001419
69397036	69397036	00:00:00.001199
69397037	69397037	00:00:00.002034
69397038	69397038	00:00:00.001448
69397039	69397039	00:00:00.001465
69397040	69397040	00:00:00.001393
69397041	69397041	00:00:00.001334
69397042	69397042	00:00:00.001814
69397043	69397043	00:00:00.001519
69397044	69397044	00:00:00.001308
69397045	69397045	00:00:00.001994
69397046	69397046	00:00:00.001585
69397047	69397047	00:00:00.001691
69397048	69397048	00:00:00.00187
69397049	69397049	00:00:00.001332
69397050	69397050	00:00:00.001518
69397051	69397051	00:00:00.001368
69397052	69397052	00:00:00.001943
69397053	69397053	00:00:00.001969
69397054	69397054	00:00:00.001123
69397055	69397055	00:00:00.001222
69397056	69397056	00:00:00.001158
69397057	69397057	00:00:00.001179
69397058	69397058	00:00:00.001184
69397059	69397059	00:00:00.001091
69397060	69397060	00:00:00.001417
69397061	69397061	00:00:00.001185
69397062	69397062	00:00:00.002543
69397063	69397063	00:00:00.001444
69397064	69397064	00:00:00.001247
69397065	69397065	00:00:00.002539
69397066	69397066	00:00:00.00115
69397067	69397067	00:00:00.00144
69397068	69397068	00:00:00.00148
69397069	69397069	00:00:00.001306
69397070	69397070	00:00:00.001471
69397071	69397071	00:00:00.001284
69397072	69397072	00:00:00.001348
69397073	69397073	00:00:00.001126
69397074	69397074	00:00:00.001105
69397075	69397075	00:00:00.001645
69397076	69397076	00:00:00.001488
69397077	69397077	00:00:00.002543
69397078	69397078	00:00:00.001587
69397079	69397079	00:00:00.00122
69397080	69397080	00:00:00.004667
69397081	69397081	00:00:00.001518
69397082	69397082	00:00:00.00141
69397083	69397083	00:00:00.00125
69397084	69397084	00:00:00.001066
69397085	69397085	00:00:00.001195
69397086	69397086	00:00:00.001267
69397087	69397087	00:00:00.001581
69397088	69397088	00:00:00.001313
69397089	69397089	00:00:00.001309
69397090	69397090	00:00:00.001537
69397091	69397091	00:00:00.001243
69397092	69397092	00:00:00.001739
69397093	69397093	00:00:00.001512
69397094	69397094	00:00:00.001303
69397095	69397095	00:00:00.001688
69397096	69397096	00:00:00.001875
69397097	69397097	00:00:00.001688
69397098	69397098	00:00:00.001627
69397099	69397099	00:00:00.008746
69397100	69397100	00:00:00.001724
69397101	69397101	00:00:00.001795
69397102	69397102	00:00:00.001879
69397103	69397103	00:00:00.001806
69397104	69397104	00:00:00.001319
69397105	69397105	00:00:00.001554
69397106	69397106	00:00:00.001138
69397107	69397107	00:00:00.001267
69397108	69397108	00:00:00.001936
69397109	69397109	00:00:00.001325
69397110	69397110	00:00:00.001527
69397111	69397111	00:00:00.001093
69397112	69397112	00:00:00.001072
69397113	69397113	00:00:00.001829
69397114	69397114	00:00:00.001374
69397115	69397115	00:00:00.001321
69397116	69397116	00:00:00.001433
69397117	69397117	00:00:00.001293
69397118	69397118	00:00:00.001407
69397119	69397119	00:00:00.001165
69397120	69397120	00:00:00.001499
69397121	69397121	00:00:00.00122
69397122	69397122	00:00:00.001435
69397123	69397123	00:00:00.001345
69397124	69397124	00:00:00.001171
69397125	69397125	00:00:00.00156
69397126	69397126	00:00:00.00141
69397127	69397127	00:00:00.001423
69397128	69397128	00:00:00.001358
69397129	69397129	00:00:00.00137
69397130	69397130	00:00:00.001332
69397131	69397131	00:00:00.001539
69397132	69397132	00:00:00.00112
69397133	69397133	00:00:00.001314
69397134	69397134	00:00:00.00106
69397135	69397135	00:00:00.001345
69397136	69397136	00:00:00.00164
69397137	69397137	00:00:00.001373
69397138	69397138	00:00:00.002115
69397139	69397139	00:00:00.001212
69397140	69397140	00:00:00.001912
69397141	69397141	00:00:00.001198
69397142	69397142	00:00:00.001704
69397143	69397143	00:00:00.001274
69397144	69397144	00:00:00.001099
69397145	69397145	00:00:00.001476
69397146	69397146	00:00:00.001312
69397147	69397147	00:00:00.001457
69397148	69397148	00:00:00.001289
69397149	69397149	00:00:00.001147
69397150	69397150	00:00:00.001579
69397151	69397151	00:00:00.001188
69397152	69397152	00:00:00.001302
69397153	69397153	00:00:00.001218
69397154	69397154	00:00:00.001154
69397155	69397155	00:00:00.001595
69397156	69397156	00:00:00.001466
69397157	69397157	00:00:00.001359
69397158	69397158	00:00:00.001296
69397159	69397159	00:00:00.001074
69397160	69397160	00:00:00.001396
69397161	69397161	00:00:00.001102
69397162	69397162	00:00:00.001123
69397163	69397163	00:00:00.001241
69397164	69397164	00:00:00.001157
69397165	69397165	00:00:00.001658
69397166	69397166	00:00:00.001752
69397167	69397167	00:00:00.001334
69397168	69397168	00:00:00.001308
69397169	69397169	00:00:00.001368
69397170	69397170	00:00:00.001456
69397171	69397171	00:00:00.001199
69397172	69397172	00:00:00.001858
69397173	69397173	00:00:00.001043
69397174	69397174	00:00:00.001337
69397175	69397175	00:00:00.001636
69397176	69397176	00:00:00.001187
69397177	69397177	00:00:00.001366
69397178	69397178	00:00:00.001168
69397179	69397179	00:00:00.001386
69397180	69397180	00:00:00.001361
69397181	69397181	00:00:00.001433
69397182	69397182	00:00:00.001184
69397183	69397183	00:00:00.001231
69397184	69397184	00:00:00.001472
69397185	69397185	00:00:00.001273
69397186	69397186	00:00:00.001401
69397187	69397187	00:00:00.001713
69397188	69397188	00:00:00.001916
69397189	69397189	00:00:00.001558
69397190	69397190	00:00:00.001498
69397191	69397191	00:00:00.001364
69397192	69397192	00:00:00.004711
69397193	69397193	00:00:00.001307
69397194	69397194	00:00:00.001133
69397195	69397195	00:00:00.002262
69397196	69397196	00:00:00.001497
69397197	69397197	00:00:00.004578
69397198	69397198	00:00:00.001216
69397199	69397199	00:00:00.001148
69397200	69397200	00:00:00.001718
69397201	69397201	00:00:00.001192
69397202	69397202	00:00:00.00135
69397203	69397203	00:00:00.002055
69397204	69397204	00:00:00.001235
69397205	69397205	00:00:00.001914
69397206	69397206	00:00:00.001279
69397207	69397207	00:00:00.001327
69397208	69397208	00:00:00.001322
69397209	69397209	00:00:00.001879
69397210	69397210	00:00:00.001443
69397211	69397211	00:00:00.001093
69397212	69397212	00:00:00.001529
69397213	69397213	00:00:00.001314
69397214	69397214	00:00:00.0011
69397215	69397215	00:00:00.001266
69397216	69397216	00:00:00.00127
69397217	69397217	00:00:00.001316
69397218	69397218	00:00:00.001003
69397219	69397219	00:00:00.004906
69397220	69397220	00:00:00.001334
69397221	69397221	00:00:00.001205
69397222	69397222	00:00:00.001316
69397223	69397223	00:00:00.001236
69397224	69397224	00:00:00.001135
69397225	69397225	00:00:00.001466
69397226	69397226	00:00:00.001441
69397227	69397227	00:00:00.001675
69397228	69397228	00:00:00.002649
69397229	69397229	00:00:00.001225
69397230	69397230	00:00:00.001348
69397231	69397231	00:00:00.001258
69397232	69397232	00:00:00.001579
69397233	69397233	00:00:00.001518
69397234	69397234	00:00:00.001202
69397235	69397235	00:00:00.002053
69397236	69397236	00:00:00.001614
69397237	69397237	00:00:00.001911
69397238	69397238	00:00:00.001308
69397239	69397239	00:00:00.001574
69397240	69397240	00:00:00.001635
69397241	69397241	00:00:00.004021
69397242	69397242	00:00:00.001672
69397243	69397243	00:00:00.001269
69397244	69397244	00:00:00.001407
69397245	69397245	00:00:00.001585
69397246	69397246	00:00:00.001166
69397247	69397247	00:00:00.002138
69397248	69397248	00:00:00.001368
69397249	69397249	00:00:00.001072
69397250	69397250	00:00:00.001127
69397251	69397251	00:00:00.001795
69397252	69397252	00:00:00.002005
69397253	69397253	00:00:00.001749
69397254	69397254	00:00:00.000993
69397255	69397255	00:00:00.00131
69397256	69397256	00:00:00.001681
69397257	69397257	00:00:00.001752
69397258	69397258	00:00:00.00122
69397259	69397259	00:00:00.001582
69397260	69397260	00:00:00.001241
69397261	69397261	00:00:00.001082
69397262	69397262	00:00:00.001314
69397263	69397263	00:00:00.001143
69397264	69397264	00:00:00.001005
69397265	69397265	00:00:00.001559
69397266	69397266	00:00:00.001384
69397267	69397267	00:00:00.001453
69397268	69397268	00:00:00.001284
69397269	69397269	00:00:00.001232
69397270	69397270	00:00:00.001414
69397271	69397271	00:00:00.001099
69397272	69397272	00:00:00.003617
69397273	69397273	00:00:00.001979
69397274	69397274	00:00:00.001128
69397275	69397275	00:00:00.001847
69397276	69397276	00:00:00.00113
69397277	69397277	00:00:00.001557
69397278	69397278	00:00:00.001286
69397279	69397279	00:00:00.001072
69397280	69397280	00:00:00.001384
69397281	69397281	00:00:00.001163
69397282	69397282	00:00:00.001593
69397283	69397283	00:00:00.001401
69397284	69397284	00:00:00.001219
69397285	69397285	00:00:00.005461
69397286	69397286	00:00:00.00126
69397287	69397287	00:00:00.001885
69397288	69397288	00:00:00.001253
69397289	69397289	00:00:00.001335
69397290	69397290	00:00:00.00166
69397291	69397291	00:00:00.001419
69397292	69397292	00:00:00.001317
69397293	69397293	00:00:00.001392
69397294	69397294	00:00:00.001559
69397295	69397295	00:00:00.001233
69397296	69397296	00:00:00.001105
69397297	69397297	00:00:00.00129
69397298	69397298	00:00:00.001376
69397299	69397299	00:00:00.001442
69397300	69397300	00:00:00.001616
69397301	69397301	00:00:00.001101
69397302	69397302	00:00:00.001224
69397303	69397303	00:00:00.001303
69397304	69397304	00:00:00.001708
69397305	69397305	00:00:00.001615
69397306	69397306	00:00:00.001294
69397307	69397307	00:00:00.001721
69397308	69397308	00:00:00.001441
69397309	69397309	00:00:00.001417
69397310	69397310	00:00:00.001458
69397311	69397311	00:00:00.00134
69397312	69397312	00:00:00.001646
69397313	69397313	00:00:00.001484
69397314	69397314	00:00:00.001348
69397315	69397315	00:00:00.001471
69397316	69397316	00:00:00.001205
69397317	69397317	00:00:00.002492
69397318	69397318	00:00:00.001221
69397319	69397319	00:00:00.001237
69397320	69397320	00:00:00.002087
69397321	69397321	00:00:00.001149
69397322	69397322	00:00:00.001927
69397323	69397323	00:00:00.001245
69397324	69397324	00:00:00.001821
69397325	69397325	00:00:00.001978
69397326	69397326	00:00:00.001347
69397327	69397327	00:00:00.001625
69397328	69397328	00:00:00.001458
69397329	69397329	00:00:00.001698
69397330	69397330	00:00:00.001354
69397331	69397331	00:00:00.001352
69397332	69397332	00:00:00.003985
69397333	69397333	00:00:00.001306
69397334	69397334	00:00:00.001373
69397335	69397335	00:00:00.003609
69397336	69397336	00:00:00.001738
69397337	69397337	00:00:00.001769
69397338	69397338	00:00:00.00165
69397339	69397339	00:00:00.006782
69397340	69397340	00:00:00.004068
69397341	69397341	00:00:00.002056
69397342	69397342	00:00:00.002051
69397343	69397343	00:00:00.001255
\.


--
-- PostgreSQL database dump complete
--

```





